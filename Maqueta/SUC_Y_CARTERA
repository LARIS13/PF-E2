CREATE OR REPLACE TABLE BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y_CARTERA AS
 
SELECT PERIODO, SUCURSAL, "INMOR Cartera" AS CONCEPTO,
INMOR AS ACTUAL, INMOR_ZONA AS ZONA,
LAG(INMOR) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(INMOR) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- INMOR) AS VARIACION,
  CASE
    WHEN INMOR < 0.10
      THEN ' Excelente'
    WHEN INMOR < 0.14
      THEN ' Estable con tendencia en alza'
    WHEN INMOR > 0.14
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN INMOR < LAG(INMOR) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR < INMOR_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN INMOR > LAG(INMOR) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR < INMOR_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN INMOR > LAG(INMOR) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR > INMOR_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN INMOR < LAG(INMOR) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR > INMOR_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  "NULL" AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`
 
UNION ALL 

SELECT PERIODO, SUCURSAL, "Entregas TDC por Persona" AS CONCEPTO,
ENTREGAS_TDC_X_PERSONA AS ACTUAL, ENTREGAS_TDC_X_PERSONA_ZONA AS ZONA,
LAG(ENTREGAS_TDC_X_PERSONA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(ENTREGAS_TDC_X_PERSONA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- ENTREGAS_TDC_X_PERSONA) AS VARIACION,
  CASE
    WHEN ENTREGAS_TDC_X_PERSONA > 0.95
      THEN ' Excelente'
    WHEN ENTREGAS_TDC_X_PERSONA > 0.75
      THEN ' Estable'
    WHEN ENTREGAS_TDC_X_PERSONA < 0.75
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN ENTREGAS_TDC_X_PERSONA < LAG(ENTREGAS_TDC_X_PERSONA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_TDC_X_PERSONA < ENTREGAS_TDC_X_PERSONA_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN ENTREGAS_TDC_X_PERSONA > LAG(ENTREGAS_TDC_X_PERSONA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_TDC_X_PERSONA < ENTREGAS_TDC_X_PERSONA_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_TDC_X_PERSONA > LAG(ENTREGAS_TDC_X_PERSONA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_TDC_X_PERSONA > ENTREGAS_TDC_X_PERSONA_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_TDC_X_PERSONA < LAG(ENTREGAS_TDC_X_PERSONA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_TDC_X_PERSONA > ENTREGAS_TDC_X_PERSONA_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN ENTREGAS_TDC_X_PERSONA <0.75
      THEN  "Ajuste de Personal" 
    WHEN ENTREGAS_TDC_X_PERSONA <0.95
      THEN  "Impulsar Colocacion" 
    ELSE "NULL"
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Entregas PP por Promotor" AS CONCEPTO,
ENTREGAS_PP_PROM AS ACTUAL, ENTREGAS_PP_PROM_ZONA AS ZONA,
LAG(ENTREGAS_PP_PROM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(ENTREGAS_PP_PROM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- ENTREGAS_PP_PROM) AS VARIACION,
  CASE
    WHEN ENTREGAS_PP_PROM > 0.95
      THEN ' Excelente'
    WHEN ENTREGAS_PP_PROM > 0.75
      THEN ' Estable'
    WHEN ENTREGAS_PP_PROM < 0.75
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN ENTREGAS_PP_PROM < LAG(ENTREGAS_PP_PROM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_PROM < ENTREGAS_PP_PROM_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN ENTREGAS_PP_PROM > LAG(ENTREGAS_PP_PROM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_PROM < ENTREGAS_PP_PROM_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_PP_PROM > LAG(ENTREGAS_PP_PROM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_PROM > ENTREGAS_PP_PROM_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_PP_PROM < LAG(ENTREGAS_PP_PROM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_PROM > ENTREGAS_PP_PROM_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN ENTREGAS_PP_PROM <0.75
      THEN  "Ajuste de Personal" 
    WHEN ENTREGAS_PP_PROM <0.95
      THEN  "Impulsar Colocacion" 
    ELSE "NULL"
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Entregas PP por Cajero Mixto" AS CONCEPTO,
ENTREGAS_PP_CM AS ACTUAL, ENTREGAS_PP_CM_ZONA AS ZONA,
LAG(ENTREGAS_PP_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(ENTREGAS_PP_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- ENTREGAS_PP_CM) AS VARIACION,
  CASE
    WHEN ENTREGAS_PP_CM > 0.95
      THEN ' Excelente'
    WHEN ENTREGAS_PP_CM > 0.75
      THEN ' Estable'
    WHEN ENTREGAS_PP_CM < 0.75
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN ENTREGAS_PP_CM < LAG(ENTREGAS_PP_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CM < ENTREGAS_PP_CM_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN ENTREGAS_PP_CM > LAG(ENTREGAS_PP_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CM < ENTREGAS_PP_CM_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_PP_CM > LAG(ENTREGAS_PP_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CM > ENTREGAS_PP_CM_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_PP_CM < LAG(ENTREGAS_PP_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CM > ENTREGAS_PP_CM_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN ENTREGAS_PP_CM <0.75
      THEN  "Ajuste de Personal" 
    WHEN ENTREGAS_PP_CM <0.95
      THEN  "Impulsar Colocacion" 
    ELSE "NULL"
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Entregas PP por Cajero de Abono" AS CONCEPTO,
ENTREGAS_PP_CA AS ACTUAL, ENTREGAS_PP_CA_ZONA AS ZONA,
LAG(ENTREGAS_PP_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(ENTREGAS_PP_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- ENTREGAS_PP_CA) AS VARIACION,
  CASE
    WHEN ENTREGAS_PP_CA > 0.95
      THEN ' Excelente'
    WHEN ENTREGAS_PP_CA > 0.75
      THEN ' Estable'
    WHEN ENTREGAS_PP_CA < 0.75
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN ENTREGAS_PP_CA < LAG(ENTREGAS_PP_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CA < ENTREGAS_PP_CA_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN ENTREGAS_PP_CA > LAG(ENTREGAS_PP_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CA < ENTREGAS_PP_CA_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_PP_CA > LAG(ENTREGAS_PP_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CA > ENTREGAS_PP_CA_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN ENTREGAS_PP_CA < LAG(ENTREGAS_PP_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND ENTREGAS_PP_CA > ENTREGAS_PP_CA_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN ENTREGAS_PP_CA <0.75
      THEN  "Ajuste de Personal" 
    WHEN ENTREGAS_PP_CA <0.95
      THEN  "Impulsar Colocacion" 
    ELSE "NULL"
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Transacciones por Cajero Mixto" AS CONCEPTO,
TRX_X_CM AS ACTUAL, TRX_X_CM_ZONA AS ZONA,
LAG(TRX_X_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(TRX_X_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- TRX_X_CM) AS VARIACION,
  CASE
    WHEN TRX_X_CM > 215 AND TRX_X_CM < 245
      THEN ' Excelente'
    WHEN TRX_X_CM > 245
      THEN ' Alto'
    WHEN TRX_X_CM < 215
      THEN ' Bajo'
  END AS Estado,
 
  CASE
    WHEN TRX_X_CM < LAG(TRX_X_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CM < TRX_X_CM_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN TRX_X_CM > LAG(TRX_X_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CM < TRX_X_CM_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN TRX_X_CM > LAG(TRX_X_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CM > TRX_X_CM_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN TRX_X_CM < LAG(TRX_X_CM) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CM > TRX_X_CM_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN TRX_X_CM > 215 AND TRX_X_CM < 245
      THEN 'NULL'
    WHEN TRX_X_CM > 245
      THEN 'Ajustar planta TRX alto'
    WHEN TRX_X_CM < 215
      THEN 'Ajustar planta TRX bajo'
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Transacciones por Cajero Abono" AS CONCEPTO,
TRX_X_CA AS ACTUAL, TRX_X_CA_ZONA AS ZONA,
LAG(TRX_X_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(TRX_X_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- TRX_X_CA) AS VARIACION,
  CASE
    WHEN TRX_X_CA > 215 AND TRX_X_CA < 245
      THEN ' Excelente'
    WHEN TRX_X_CA > 245
      THEN ' Alto'
    WHEN TRX_X_CA < 215
      THEN ' Bajo'
  END AS Estado,
 
  CASE
    WHEN TRX_X_CA < LAG(TRX_X_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CA < TRX_X_CA_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN TRX_X_CA > LAG(TRX_X_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CA < TRX_X_CA_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN TRX_X_CA > LAG(TRX_X_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CA > TRX_X_CA_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN TRX_X_CA < LAG(TRX_X_CA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND TRX_X_CA > TRX_X_CA_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN TRX_X_CA > 215 AND TRX_X_CA < 245
      THEN 'NULL'
    WHEN TRX_X_CA > 245
      THEN 'Ajustar planta TRX alto'
    WHEN TRX_X_CA < 215
      THEN 'Ajustar planta TRX bajo'
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Saldo Nuevo Promedio Afore" AS CONCEPTO,
SAL_NUEV_PROM_AF AS ACTUAL, SAL_NUEV_PROM_AF_ZONA AS ZONA,
LAG(SAL_NUEV_PROM_AF) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(SAL_NUEV_PROM_AF) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- SAL_NUEV_PROM_AF) AS VARIACION,
  CASE
    WHEN SAL_NUEV_PROM_AF > SAL_NUEV_PROM_AF_ZONA
      THEN ' Excelente'
    WHEN SAL_NUEV_PROM_AF < SAL_NUEV_PROM_AF_ZONA
      THEN ' Mas bajo que zona'
  END AS Estado,
 
  CASE
    WHEN SAL_NUEV_PROM_AF < LAG(SAL_NUEV_PROM_AF) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND SAL_NUEV_PROM_AF > SAL_NUEV_PROM_AF_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN SAL_NUEV_PROM_AF > LAG(SAL_NUEV_PROM_AF) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND SAL_NUEV_PROM_AF > SAL_NUEV_PROM_AF_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN SAL_NUEV_PROM_AF > LAG(SAL_NUEV_PROM_AF) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND SAL_NUEV_PROM_AF < SAL_NUEV_PROM_AF_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN SAL_NUEV_PROM_AF < LAG(SAL_NUEV_PROM_AF) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND SAL_NUEV_PROM_AF < SAL_NUEV_PROM_AF_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN SAL_NUEV_PROM_AF > SAL_NUEV_PROM_AF_ZONA
      THEN 'NULL'
    WHEN SAL_NUEV_PROM_AF < SAL_NUEV_PROM_AF_ZONA
      THEN 'Incrementar el cambaceo'
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Cumplimiento Meta Venta Nueva Seguros" AS CONCEPTO,
CUMP_META_VENTA_NUEVA_SEG AS ACTUAL, CUMP_META_VENTA_NUEVA_SEG_ZONA AS ZONA,
LAG(CUMP_META_VENTA_NUEVA_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(CUMP_META_VENTA_NUEVA_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- CUMP_META_VENTA_NUEVA_SEG) AS VARIACION,
  CASE
    WHEN CUMP_META_VENTA_NUEVA_SEG > 0.90
      THEN ' Excelente'
    WHEN CUMP_META_VENTA_NUEVA_SEG > 0.75
      THEN ' Estable'
    WHEN CUMP_META_VENTA_NUEVA_SEG < 0.75
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN CUMP_META_VENTA_NUEVA_SEG < LAG(CUMP_META_VENTA_NUEVA_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_VENTA_NUEVA_SEG < CUMP_META_VENTA_NUEVA_SEG_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN CUMP_META_VENTA_NUEVA_SEG > LAG(CUMP_META_VENTA_NUEVA_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_VENTA_NUEVA_SEG < CUMP_META_VENTA_NUEVA_SEG_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN CUMP_META_VENTA_NUEVA_SEG > LAG(CUMP_META_VENTA_NUEVA_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_VENTA_NUEVA_SEG > CUMP_META_VENTA_NUEVA_SEG_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN CUMP_META_VENTA_NUEVA_SEG < LAG(CUMP_META_VENTA_NUEVA_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_VENTA_NUEVA_SEG > CUMP_META_VENTA_NUEVA_SEG_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN CUMP_META_VENTA_NUEVA_SEG < 0.75
      THEN 'Volver a hacer curso'
    WHEN CUMP_META_VENTA_NUEVA_SEG < 0.90
      THEN 'Repasar practicas de Cobranza'
    ELSE "NULL"
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Cumplimiento Meta Reeactivaci贸n Seguros" AS CONCEPTO,
CUMP_META_REEACTIV_SEG AS ACTUAL, CUMP_META_REEACTIV_SEG_ZONA AS ZONA,
LAG(CUMP_META_REEACTIV_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(CUMP_META_REEACTIV_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- CUMP_META_REEACTIV_SEG) AS VARIACION,
  CASE
    WHEN CUMP_META_REEACTIV_SEG > 0.90
      THEN ' Excelente'
    WHEN CUMP_META_REEACTIV_SEG > 0.75
      THEN ' Estable'
    WHEN CUMP_META_REEACTIV_SEG < 0.75
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN CUMP_META_REEACTIV_SEG < LAG(CUMP_META_REEACTIV_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_REEACTIV_SEG < CUMP_META_REEACTIV_SEG_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN CUMP_META_REEACTIV_SEG > LAG(CUMP_META_REEACTIV_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_REEACTIV_SEG < CUMP_META_REEACTIV_SEG_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN CUMP_META_REEACTIV_SEG > LAG(CUMP_META_REEACTIV_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_REEACTIV_SEG > CUMP_META_REEACTIV_SEG_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN CUMP_META_REEACTIV_SEG < LAG(CUMP_META_REEACTIV_SEG) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_META_REEACTIV_SEG > CUMP_META_REEACTIV_SEG_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN CUMP_META_REEACTIV_SEG < 0.75
      THEN 'Volver a hacer curso'
    WHEN CUMP_META_REEACTIV_SEG < 0.90
      THEN 'Repasar practicas de Cobranza'
    ELSE "NULL"
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL

SELECT PERIODO, SUCURSAL, "Cumplimiento Cuentas Captaci贸n" AS CONCEPTO,
CUMP_CUEN_CAP AS ACTUAL, CUMP_CUEN_CAP_ZONA AS ZONA,
LAG(CUMP_CUEN_CAP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(CUMP_CUEN_CAP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- CUMP_CUEN_CAP) AS VARIACION,
  CASE
    WHEN CUMP_CUEN_CAP > 0.95
      THEN ' Excelente'
    WHEN CUMP_CUEN_CAP > 0.70
      THEN ' Estable con tendencia en alza'
    WHEN CUMP_CUEN_CAP < 0.14
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN CUMP_CUEN_CAP < LAG(CUMP_CUEN_CAP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_CUEN_CAP < CUMP_CUEN_CAP_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN CUMP_CUEN_CAP > LAG(CUMP_CUEN_CAP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_CUEN_CAP < CUMP_CUEN_CAP_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN CUMP_CUEN_CAP > LAG(CUMP_CUEN_CAP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_CUEN_CAP > CUMP_CUEN_CAP_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN CUMP_CUEN_CAP < LAG(CUMP_CUEN_CAP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMP_CUEN_CAP > CUMP_CUEN_CAP_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  CASE 
    WHEN CUMP_CUEN_CAP <0.95
      THEN  "Impulsar Captaci贸n" 
    ELSE "NULL"
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`

UNION ALL
 
SELECT PERIODO, SUCURSAL,"INMOR Pp" AS CONCEPTO,
INMOR_PP AS ACTUAL, INMOR_PP_ZONA AS ZONA,
LAG(INMOR_PP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
((LAG(INMOR_PP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- INMOR_PP) AS VARIACION,
  CASE
    WHEN INMOR_PP < 0.10
      THEN ' Excelente'
    WHEN INMOR_PP < 0.14
      THEN ' Estable con tendencia en alza'
    WHEN INMOR_PP > 0.14
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN INMOR_PP < LAG(INMOR_PP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR_PP < INMOR_PP_Zona
      THEN 'Mejor que la zona y Con tendencia a la baja'
 
    WHEN INMOR_PP > LAG(INMOR_PP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR_PP < INMOR_PP_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN INMOR_PP > LAG(INMOR_PP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR > INMOR_PP_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN INMOR_PP < LAG(INMOR_PP) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR > INMOR_PP_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
"NULL" AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`
 
  UNION ALL
 
  SELECT PERIODO, SUCURSAL, "INMOR TDC" AS CONCEPTO,
INMOR_TDC AS CONCEPTO, INMOR_TDC_ZONA AS INMOR_ZONA,
LAG(INMOR_TDC) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS INMORPP_ANTERIOR,
((LAG(INMOR_TDC) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO))- INMOR_TDC) AS INMORPP_VARIACION,
  CASE
    WHEN INMOR_TDC < 0.10
      THEN ' Excelente'
    WHEN INMOR_TDC < 0.14
      THEN ' Estable con tendencia en alza'
    WHEN INMOR_TDC > 0.14
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN INMOR_TDC < LAG(INMOR_TDC) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR_TDC < INMOR_TDC_Zona
      THEN 'Mejor que la zona y Con tendencia a la baja'
 
    WHEN INMOR_TDC > LAG(INMOR_TDC) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR_TDC < INMOR_TDC_Zona
      THEN 'Mejor que la zona y Con tendencia en alza'
 
    WHEN INMOR_TDC > LAG(INMOR_TDC) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR > INMOR_TDC_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN INMOR_TDC < LAG(INMOR_TDC) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND INMOR > INMOR_TDC_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
  "NULL" AS RECOMENDACION
 
  FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`
 
UNION ALL
 
SELECT PERIODO, SUCURSAL, "Cumplimiento Metas" AS CONCEPTO,
CUMPLIMIENTO_METAS AS ACTUAL, CUMPLIMIENTO_METAS_ZONA AS ZONA,
LAG(CUMPLIMIENTO_METAS) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
CUMPLIMIENTO_METAS_VARIACION AS VARIACION,
  CASE
    WHEN CUMPLIMIENTO_METAS >= 0.98
      THEN ' Optimo'
    WHEN CUMPLIMIENTO_METAS > 0.85
      THEN ' En observaci贸n'
    WHEN CUMPLIMIENTO_METAS <= 0.85
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN CUMPLIMIENTO_METAS > LAG(CUMPLIMIENTO_METAS) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMPLIMIENTO_METAS > CUMPLIMIENTO_METAS_Zona
      THEN 'Mejor que la zona y con tendencia en alza'
 
    WHEN CUMPLIMIENTO_METAS < LAG(CUMPLIMIENTO_METAS) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMPLIMIENTO_METAS > CUMPLIMIENTO_METAS_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN CUMPLIMIENTO_METAS > LAG(CUMPLIMIENTO_METAS) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMPLIMIENTO_METAS < CUMPLIMIENTO_METAS_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN CUMPLIMIENTO_METAS < LAG(CUMPLIMIENTO_METAS) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND CUMPLIMIENTO_METAS < CUMPLIMIENTO_METAS_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
 
CASE
    WHEN CUMPLIMIENTO_METAS >= 0.8
      THEN ' Felicitaci贸n p煤blica y personal al equipo y responsables, Pedir retroalimentaci贸n al equipo durante las minijuntas sobre qu茅 funcion贸 bien'
    WHEN CUMPLIMIENTO_METAS > 0.7
      THEN 'Mantener rutinas de seguimiento efectivo (revisi贸n de metas diarias o semanales),  Motivar al equipo a identificar oportunidades de mejora o eficiencia propia'
    WHEN CUMPLIMIENTO_METAS <= 0.7
      THEN 'Establecer Reuniones diarias breves de enfoque con colaboradores resagados para recuperar el cumplimiento, Activar micro-capacitaciones semanales con ejemplos pr谩cticos'
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`
 
UNION ALL
 
SELECT PERIODO, SUCURSAL, "PRIMERA COMPRA" AS CONCEPTO,
PRIMERA_COMPRA AS ACTUAL, PRIMERA_COMPRA_ZONA AS ZONA,
LAG(PRIMERA_COMPRA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AS ANTERIOR,
PRIMERA_COMPRA_VARIACION AS VARIACION,
  CASE
    WHEN PRIMERA_COMPRA >= 0.8
      THEN ' En linea'
    WHEN PRIMERA_COMPRA > 0.7
      THEN ' En observaci贸n'
    WHEN PRIMERA_COMPRA <= 0.7
      THEN ' Cr铆tico'
  END AS Estado,
 
  CASE
    WHEN PRIMERA_COMPRA > LAG(PRIMERA_COMPRA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND PRIMERA_COMPRA > PRIMERA_COMPRA_Zona
      THEN 'Mejor que la zona y con tendencia en alza'
 
    WHEN PRIMERA_COMPRA < LAG(PRIMERA_COMPRA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND PRIMERA_COMPRA > PRIMERA_COMPRA_Zona
      THEN 'Mejor que la zona y con tendencia a la baja'
 
    WHEN PRIMERA_COMPRA > LAG(PRIMERA_COMPRA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND PRIMERA_COMPRA < PRIMERA_COMPRA_Zona
      THEN 'Peor que la zona y Con tendencia en alza'
 
    WHEN PRIMERA_COMPRA < LAG(PRIMERA_COMPRA) OVER (PARTITION BY Sucursal,EXTRACT(MONTH FROM PERIODO) ORDER BY PERIODO) AND PRIMERA_COMPRA < PRIMERA_COMPRA_Zona
      THEN 'Peor que la zona y Con tendencia a la baja'
  END AS Dictamen,
  CASE
    WHEN PRIMERA_COMPRA >= 0.8
      THEN 'Reconocer p煤blicamente al equipo o responsable, Documentar pr谩cticas exitosas y compartir con otras sucursales, Mantener enfoque: asegurar que la activaci贸n se traduzca en uso recurrente y no solo en una primera compra simb贸lica'
     
    WHEN PRIMERA_COMPRA > 0.7
      THEN 'Continuar con rutinas de revisi贸n y seguimiento posterior a la colocaci贸n, Motivar al equipo con retroalimentaci贸n positiva, Mantener registro semanal de tasas de activaci贸n por ejecutivo para identificar mejoras sostenidas'
    WHEN PRIMERA_COMPRA <= 0.7
      THEN 'Verificar activaci贸n en el momento de entrega cuando sea posible, Asignar seguimiento personalizado dentro de los primeros 3 d铆as, Asegurar que el cliente entienda el uso y beneficios b谩sicos de la tarjeta, Supervisar que el equipo utilice un guion claro de activaci贸n'
  END AS RECOMENDACION
 
FROM `BI_SUCURSALES_BANCO.ZZ_MOCK_SUC_Y`
 
